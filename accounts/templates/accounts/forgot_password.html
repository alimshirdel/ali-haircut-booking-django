{% extends 'base/base.html' %}
{% load static %}

{% block title %}
  بازیابی رمز عبور
{% endblock %}

{% block links %}
  <link rel="stylesheet" href="{% static 'accounts/css/forgot_password.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="icon" href="{% static 'accounts/icons/reset_password.ico' %}" type="image/ico/jpg" />
{% endblock %}

{% block content %}
  <div class="login-page">
    <a href="{% url 'shops:shops_url' %}" class="btn-back"><i class="fa-solid fa-arrow-left-long"></i> بازگشت</a>

    <div class="login-card">
      <h2>بازیابی رمز عبور</h2>

      {% if messages %}
        <ul class="messages">
          {% for message in messages %}
            <li class="message {{ message.tags }}">
              <i class="fa {% if message.tags == 'success' %}
                  fa-check-circle
                {% else %}
                  fa-info-circle
                {% endif %}">

              </i>
              {{ message }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if step == 1 %}
        <p class="info-text">ایمیل یا شماره تلفن خود را وارد کنید تا کد تایید برایتان ارسال شود.</p>
        <form method="post" novalidate>
          {% csrf_token %}
          <div class="input-group">
            <i class="fa-solid fa-envelope-open-text"></i>
            {{ form.identifier }}
          </div>
          {% for error in form.identifier.errors %}
            <p class="error-message">{{ error }}</p>
          {% endfor %}
          <button type="submit" class="btn-login">ارسال کد تایید</button>
        </form>
      {% elif step == 2 %}
        <p class="info-text">کد تایید را وارد و سپس رمز جدید را تعیین کنید.</p>
        <form method="post" novalidate>
          {% csrf_token %}
          <div class="input-group">
            <i class="fa-solid fa-shield-halved"></i>
            {{ form.opt }}
          </div>
          {% for error in form.opt.errors %}
            <p class="error-message">{{ error }}</p>
          {% endfor %}

          <div class="input-group">
            <i class="fa-solid fa-lock"></i>
            {{ form.password }}
          </div>
          {% for error in form.password.errors %}
            <p class="error-message">{{ error }}</p>
          {% endfor %}

          <div class="input-group">
            <i class="fa-solid fa-lock"></i>
            {{ form.password_2 }}
          </div>
          {% for error in form.password_2.errors %}
            <p class="error-message">{{ error }}</p>
          {% endfor %}

          <button type="submit" class="btn-login">تغییر رمز</button>
        </form>
        <input type="hidden" id="identifier" value="{{ otp_data.identifier }}" />
        <button id="resend-btn" disabled data-url="{% url 'accounts:forgot_password_url' %}" data-csrf="{{ csrf_token }}">ارسال دوباره کد</button>
        <span id="timer" data-remaining="{{ remaining_time|default:0 }}"></span>
      {% endif %}

      <div class="login-links">
        <a href="{% url 'accounts:login_url' %}"><i class="fa fa-sign-in-alt"></i> ورود</a>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'accounts/javascript/forgot_password.js' %}"></script>
{% endblock %}
