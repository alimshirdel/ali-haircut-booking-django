{% extends 'base/base.html' %}
{% load static %}
{% load jalali_tags %}

{% block title %}
Ù…Ø¯ÛŒØ±ÛŒØª Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§
{% endblock %}

{% block links %}
<link rel="icon" href="{% static 'shops/icons/admin_comments.png' %}" type="image/png" />
<link rel="stylesheet" href="{% static 'dashboard/css/admin_comments.css' %}" />
{% endblock %}

{% block content %}
<div class="container py-5 text-end">

  <h1 class="mb-4 text-center fw-bold">ğŸ’¬ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h1>

  <!-- ÙØ±Ù… Ø¬Ø³ØªØ¬Ùˆ -->
  <form method="get" class="d-flex justify-content-center mb-4">
    <input type="text" name="date" class="form-control w-25 text-end" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ù…Ø«Ø§Ù„: 1404/07/15)" value="{{ request.GET.date }}" />
    <input type="text" name="q" class="form-control w-50 text-end" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ØŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Ø¨Ø± ØŒ Ø§Ø³Ù… Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ Ù†Ø§Ù… Ø§Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡" value="{{ request.GET.q }}" />
    <button class="btn btn-primary ms-2">Ø¬Ø³ØªØ¬Ùˆ</button>
  </form>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§ -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>Ø±Ø¯ÛŒÙ</th>
          <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
          <th>Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Ø¨Ø±</th>
          <th>Ø§Ø³Ù… Ú©Ø§Ø±Ø¨Ø±</th>
          <th>Ù†Ø§Ù… Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡</th>
          <th>Ù…ØªÙ† Ø¯ÛŒØ¯Ú¯Ø§Ù‡</th>
          <th>ØªØ§Ø±ÛŒØ® Ø§Ø±Ø³Ø§Ù„</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for comment in comments %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ comment.user.username }}</td>
          <td>{{ comment.user.phone_number }}</td>
          <td>{{ comment.user.get_full_name}}</td>
          <td>{{ comment.shop.name }}</td>
          <td class="text-start align-top">
            <div class="border rounded p-2 shadow-sm bg-light" style="max-width: 400px; overflow-wrap: break-word;">
              <p id="short-{{ comment.id }}" class="mb-1 text-muted small">
                {{ comment.content|truncatechars:100 }}
              </p>
          
              {% if comment.content|length > 100 %}
                <p id="full-{{ comment.id }}" class="mb-1 text-muted small d-none">
                  {{ comment.content }}
                </p>
                <a href="#" class="text-primary small" onclick="toggleComment(this, {{ comment.id }}); return false;">
                  Ù†Ù…Ø§ÛŒØ´ Ø¨ÛŒØ´ØªØ±
                </a>
              {% endif %}
            </div>
          </td>
          <td>{{ comment.created_at|to_jalali:'%Y/%m/%d - %H:%M' }}</td>
          <td>
            <a
              href="{% url 'dashboard:delete_comment_url' comment.id %}"
              class="btn btn-sm btn-danger"
              onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯ÛŒØ¯Ú¯Ø§Ù‡ Ù…Ø·Ù…Ø¦Ù†ÛŒØŸ')"
            >
              Ø­Ø°Ù
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-muted py-4">
            Ù‡ÛŒÚ† Ø¯ÛŒØ¯Ú¯Ø§Ù‡ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯ ğŸ˜•
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
  <div class="d-flex flex-column align-items-center mt-4">
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        {% if comments.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1&q={{ query }}&date={{ request.GET.date }}">â­ Ø§ÙˆÙ„</a>
        </li>
        <li class="page-item">
          <a
            class="page-link"
            href="?page={{ comments.previous_page_number }}&q={{ query }}&date={{ request.GET.date }}"
            >Ù‚Ø¨Ù„ÛŒ</a
          >
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">â­ Ø§ÙˆÙ„</span></li>
        <li class="page-item disabled"><span class="page-link">Ù‚Ø¨Ù„ÛŒ</span></li>
        {% endif %}

        <li class="page-item active">
          <span class="page-link"
            >ØµÙØ­Ù‡ {{ comments.number }} Ø§Ø² {{ comments.paginator.num_pages }}</span
          >
        </li>

        {% if comments.has_next %}
        <li class="page-item">
          <a
            class="page-link"
            href="?page={{ comments.next_page_number }}&q={{ query }}&date={{ request.GET.date }}"
            >Ø¨Ø¹Ø¯ÛŒ</a
          >
        </li>
        <li class="page-item">
          <a
            class="page-link"
            href="?page={{ comments.paginator.num_pages }}&q={{ query }}&date={{ request.GET.date }}"
            >Ø¢Ø®Ø± â®</a
          >
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Ø¨Ø¹Ø¯ÛŒ</span></li>
        <li class="page-item disabled"><span class="page-link">Ø¢Ø®Ø± â®</span></li>
        {% endif %}
      </ul>
    </nav>

    <!-- Ù¾Ø±Ø´ Ø¨Ù‡ ØµÙØ­Ù‡ -->
    <form method="get" class="d-flex align-items-center mt-3">
      <input type="hidden" name="q" value="{{ query }}" />
      <input type="hidden" name="date" value="{{ request.GET.date }}" />
      <label for="page" class="me-2">Ø¨Ø±Ùˆ Ø¨Ù‡ ØµÙØ­Ù‡:</label>
      <input
        type="number"
        name="page"
        min="1"
        max="{{ comments.paginator.num_pages }}"
        class="form-control form-control-sm text-center me-2"
        style="width: 80px;"
      />
      <button class="btn btn-sm btn-outline-primary" type="submit">Ø¨Ø±Ùˆ</button>
    </form>
  </div>

  <div class="text-center mt-4">
    <a href="{% url 'dashboard:admin_dashboard_url' %}" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'dashboard/js/admin_comments.js' %}"></script>
{% endblock scripts %}