{% extends 'base/base.html' %}
{% load static %}
{% load jalali_extras %}
{% load jalali_tags %}

{% block title %}
  Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø²Ø±ÙˆÙ‡Ø§
{% endblock %}
{% block links %}
  <link rel="icon" href="{% static 'dashboard/icons/admin_reservations.png' %}" type="image/ico/jpg" />
  <link rel="stylesheet" href="{% static 'dashboard/css/admin_reservations.css' %}" />
{% endblock %}
{% block content %}
  <div class="container py-5">
    <h1 class="mb-4 text-center">ğŸ“… Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø²Ø±ÙˆÙ‡Ø§</h1>

    <form method="get" class="d-flex justify-content-center mb-4">
      <input type="text" name="date" class="form-control w-25 text-end" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ù…Ø«Ø§Ù„: 1404/07/15)" value="{{ request.GET.date }}" />
      <input type="text" name="q" class="form-control w-50 text-end" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ø±Ø²Ø±Ùˆ Ú©Ù†Ù†Ø¯Ù‡ ØŒ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø²Ø±Ùˆ Ú©Ù†Ù†Ø¯Ù‡ ØŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ù†Ø§Ù… Ø§Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡" value="{{ request.GET.q }}" />
      <button class="btn btn-primary ms-2">Ø¬Ø³ØªØ¬Ùˆ</button>
    </form>

    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Ù†Ø§Ù… Ø±Ø²Ø±Ùˆ Ú©Ù†Ù†Ø¯Ù‡</th>
            <th>Ø´Ù…Ø§Ø±Ù‡ Ø±Ø²Ø±Ùˆ Ú©Ù†Ù†Ø¯Ù‡</th>
            <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
            <th>Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡</th>
            <th>ØªØ§Ø±ÛŒØ®</th>
            <th>Ø³Ø§Ø¹Øª</th>
            <th>Ø²Ù…Ø§Ù† Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for r in reservations %}
            <tr>
              <td>{{ r.full_name }}</td>
              <td>{{ r.phone_number }}</td>
              <td>{{ r.username }}</td>
              <td>{{ r.shop_name }}</td>
              <td>{{ r.date|jalali }}</td>
              <td>{{ r.time_slot }}</td>
              <td>{{ r.created_at|to_jalali:'Ù…ÙˆØ±Ø® %Y/%m/%d  Ø¯Ø± Ø³Ø§Ø¹Øª %H:%M' }}</td>
              <td>
                <a href="{% url 'dashboard:delete_reservation_url' r.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø±Ø²Ø±Ùˆ Ù…Ø·Ù…Ø¦Ù†ÛŒØŸ')">Ø­Ø°Ù</a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" class="text-muted">Ù‡ÛŒÚ† Ø±Ø²Ø±ÙˆÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯ ğŸ˜•</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Pagination Section -->
    <div class="d-flex flex-column align-items-center mt-4">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          {% if reservations.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1&q={{ query }}&date={{ request.GET.date }}">â­ Ø§ÙˆÙ„</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ reservations.previous_page_number }}&q={{ query }}&date={{ request.GET.date }}">Ù‚Ø¨Ù„ÛŒ</a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link">â­ Ø§ÙˆÙ„</span>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Ù‚Ø¨Ù„ÛŒ</span>
            </li>
          {% endif %}

          <li class="page-item active">
            <span class="page-link">ØµÙØ­Ù‡ {{ reservations.number }} Ø§Ø² {{ reservations.paginator.num_pages }}</span>
          </li>

          {% if reservations.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ reservations.next_page_number }}&q={{ query }}&date={{ request.GET.date }}">Ø¨Ø¹Ø¯ÛŒ</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ reservations.paginator.num_pages }}&q={{ query }}&date={{ request.GET.date }}">Ø¢Ø®Ø± â®</a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link">Ø¨Ø¹Ø¯ÛŒ</span>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Ø¢Ø®Ø± â®</span>
            </li>
          {% endif %}
        </ul>
      </nav>

      <!-- ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø³ØªÙ‚ÛŒÙ… -->
      <form method="get" class="d-flex align-items-center mt-2">
        <input type="hidden" name="q" value="{{ query }}" />
        <input type="hidden" name="date" value="{{ request.GET.date }}" />
        <label for="page" class="me-2">Ø¨Ø±Ùˆ Ø¨Ù‡ ØµÙØ­Ù‡:</label>
        <input type="number" name="page" min="1" max="{{ reservations.paginator.num_pages }}" class="form-control form-control-sm text-center me-2" style="width: 80px;" placeholder="Ø´Ù…Ø§Ø±Ù‡" />
        <button class="btn btn-sm btn-outline-primary" type="submit">Ø¨Ø±Ùˆ</button>
      </form>
    </div>

    <div class="text-center mt-4">
      <a href="{% url 'dashboard:admin_dashboard_url' %}" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</a>
    </div>
  </div>
{% endblock %}
